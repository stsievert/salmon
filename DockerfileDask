FROM daskdev/dask

RUN apt-get update
RUN apt-get install -y gcc cmake g++

RUN pip install --ignore-installed PyYAML
COPY salmon.yml .
RUN conda env update --file salmon.yml --prefix $(which python)/../..

WORKDIR /usr/src/salmon

# RUN mkdir /usr/src/salmon/salmon
COPY salmon/ /usr/src/salmon/salmon
COPY setup.py setup.cfg versioneer.py /usr/src/salmon/

RUN pip install -e .

ENTRYPOINT ["tini", "-g", "--", "/usr/bin/prepare.sh"]
