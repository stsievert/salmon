language: python
python: 3.7

env:
  - SALMON_NO_AUTH=1

services:
  - docker

before_install:
  - docker-compose up &
  - until curl 127.0.0.1:8421 > /dev/null 2>&1; do :; done  # wait for container to start
  - docker ps

script:
  - pip install -r requirements.txt
  - pytest tests

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUBTOKEN  # Set in the settings page of your repository, as a secure variable
  keep_history: true
  on:
    branch: master
