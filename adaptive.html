<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adaptive algorithms &mdash; Salmon v1.0.0rc5 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/autodoc_pydantic.css" type="text/css" />
      <link rel="stylesheet" href="_static/basic.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developing algorithms" href="developers.html" />
    <link rel="prev" title="Active sampling" href="benchmarks/active.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #494646" >
            <a href="index.html">
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="init.html">Experiment initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="samplers.html">Sampler configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Experiment monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="offline.html">Generating embeddings offline</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Benchmarks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="benchmarks/server.html">Concurrent Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks/active.html">Active sampling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Algorithm Developers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adaptive algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developing algorithms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #494646" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Salmon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Adaptive algorithms</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/stsievert/salmon/blob/master/docs/source/adaptive.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adaptive-algorithms">
<h1>Adaptive algorithms<a class="headerlink" href="#adaptive-algorithms" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>The API the must conform to below:</p>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/salmon.backend.sampler.Sampler.html#salmon.backend.sampler.Sampler" title="salmon.backend.sampler.Sampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">salmon.backend.sampler.Sampler</span></code></a>([ident])</p></td>
<td><p>Run a sampling algorithm.</p></td>
</tr>
</tbody>
</table>
<p>This API balances the fundamentally serial nature of adaptive algorithms with
the parallel context of web servers.</p>
<p>Typically, an adaptive algorithm looks like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">best_query</span><span class="p">()</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">get_human_answer</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</pre></div>
</div>
<p>However, web servers are different. They typically look something like the
following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/query&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">query</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;queries&quot;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/answer&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">process_answer</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="generated/salmon.backend.sampler.Sampler.html#salmon.backend.sampler.Sampler" title="salmon.backend.sampler.Sampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sampler</span></code></a> API balances the two and runs the code
to <cite>receive answers</cite> and <cite>process answers</cite> in separate processes.
<cite>Processing the received answers</cite> is an optimization that needs to be performed
quickly because <code class="docutils literal notranslate"><span class="pre">model.best_query</span></code> depends on the optimization.</p>
<p>Essentially, the following code is run in addition to the web server code
above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_alg</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">random_query</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)]</span>
        <span class="n">db</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;queries&quot;</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">pop_all</span><span class="p">(</span><span class="s2">&quot;answers&quot;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">answers</span><span class="p">)</span>
</pre></div>
</div>
<p>This means the web server can scale efficiently because the backend
optimization doesn‚Äôt block the frontend query serving. However, that also means
the adaptive algorithm needs to post queries quickly so users aren‚Äôt waiting.
Of course, the computation required to perform the embedding needs to happen
quickly too (otherwise adaptive algorithms are meaningless).</p>
<p>Luckily, Salmon should scale sufficiently well for typical use cases (e.g,
Mechnical Turk with about <span class="math notranslate nohighlight">\(n \approx 100\)</span> targets). The query search is
fast enough to search 10,000 queries in 50ms with <span class="math notranslate nohighlight">\(n = 85\)</span> targets.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="benchmarks/active.html" class="btn btn-neutral float-left" title="Active sampling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="developers.html" class="btn btn-neutral float-right" title="Developing algorithms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Scott Sievert.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>